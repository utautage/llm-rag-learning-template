<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯RAGã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 30px;
      }

      h1 {
        color: #667eea;
        margin-bottom: 10px;
        font-size: 2em;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 0.9em;
      }

      .input-section {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
      }

      #question-input {
        flex: 1;
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
      }

      #question-input:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        padding: 15px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-secondary {
        background: #f0f0f0;
        color: #333;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .status {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
      }

      .status.loading {
        background: #e3f2fd;
        color: #1976d2;
        display: block;
      }

      .status.error {
        background: #ffebee;
        color: #c62828;
        display: block;
      }

      .status.success {
        background: #e8f5e9;
        color: #2e7d32;
        display: block;
      }

      #semantic-result {
        margin-top: 20px;
      }

      .semantic-answer {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 10px;
        border-left: 5px solid #667eea;
      }

      .semantic-answer h3 {
        color: #667eea;
        margin-bottom: 15px;
      }

      .semantic-answer h4 {
        color: #333;
        margin-top: 20px;
        margin-bottom: 10px;
      }

      .semantic-answer p {
        line-height: 1.6;
        color: #333;
      }

      .semantic-answer ul {
        margin-left: 20px;
        margin-bottom: 15px;
      }

      .semantic-answer li {
        margin-bottom: 5px;
      }

      .source-doc {
        margin: 10px 0;
        padding: 15px;
        background: white;
        border-radius: 8px;
        border-left: 4px solid #2196f3;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .source-doc strong {
        color: #2196f3;
      }

      .source-doc p {
        margin: 10px 0;
        color: #555;
      }

      .source-doc small {
        color: #999;
        font-size: 0.85em;
      }

      .comparison-section {
        margin-top: 40px;
        padding: 20px;
        background: #f0f0f0;
        border-radius: 10px;
      }

      .comparison-section h3 {
        color: #333;
        margin-bottom: 15px;
      }

      .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ§  ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯RAGã‚·ã‚¹ãƒ†ãƒ </h1>
      <p class="subtitle">ã‚ªãƒ³ãƒˆãƒ­ã‚¸ãƒ¼å¼·åŒ–ã«ã‚ˆã‚‹æ„å‘³ãƒ™ãƒ¼ã‚¹ã®æ¤œç´¢</p>

      <div class="status" id="status"></div>

      <div class="input-section">
        <input
          type="text"
          id="question-input"
          placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã¨ã¯ï¼Ÿï¼‰"
          disabled
        />
        <button
          class="btn btn-primary"
          id="ask-btn"
          onclick="askSemantic()"
          disabled
        >
          ğŸ” è³ªå•ã™ã‚‹
        </button>
        <button
          class="btn btn-secondary"
          id="compare-btn"
          onclick="compareWithRAG()"
          disabled
        >
          âš–ï¸ RAGã¨æ¯”è¼ƒ
        </button>
      </div>

      <div id="semantic-result"></div>

      <div class="comparison-section" id="comparison" style="display: none;">
        <h3>ğŸ“Š é€šå¸¸RAG vs ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯RAG</h3>
        <div id="comparison-content"></div>
      </div>
    </div>

    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ -->
    <script src="js/config.js"></script>
    <script src="js/llm-client.js"></script>
    <script src="js/vector-search.js"></script>
    <script src="js/ontology.js"></script>
    <script src="js/concept-extractor.js"></script>
    <script src="js/semantic-rag.js"></script>
    <script src="js/rag-system.js"></script>
    <script>
      let semanticRAG;
      let normalRAG;

      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
      function showStatus(message, type = "loading") {
        const status = document.getElementById("status");
        status.textContent = message;
        status.className = "status " + type;
      }

      // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          showStatus("ğŸš€ ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ä¸­...", "loading");

          // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
          const [documentsRes, ontologyRes] = await Promise.all([
            fetch("data/sample-documents.json"),
            fetch("data/learning-ontology.json"),
          ]);

          const documentsData = await documentsRes.json();
          const ontologyData = await ontologyRes.json();

          // ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯RAGã®åˆæœŸåŒ–
          semanticRAG = new SemanticRAGSystem();
          await semanticRAG.initialize(documentsData.documents, ontologyData);

          // é€šå¸¸RAGã®åˆæœŸåŒ–ï¼ˆæ¯”è¼ƒç”¨ï¼‰
          normalRAG = new RAGSystem();
          await normalRAG.initialize(documentsData.documents);

          // ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
          document.getElementById("question-input").disabled = false;
          document.getElementById("ask-btn").disabled = false;
          document.getElementById("compare-btn").disabled = false;

          showStatus("âœ… ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†ï¼è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", "success");

          setTimeout(() => {
            document.getElementById("status").style.display = "none";
          }, 3000);
        } catch (error) {
          console.error("åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:", error);
          showStatus("âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message, "error");
        }
      });

      // ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢
      async function askSemantic() {
        const input = document.getElementById("question-input");
        const question = input.value.trim();

        if (!question) {
          alert("è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
          return;
        }

        try {
          showStatus("ğŸ” ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ä¸­...", "loading");
          document.getElementById("ask-btn").disabled = true;

          const result = await semanticRAG.semanticQuery(question);
          semanticRAG.displayRAGResult(result);

          document.getElementById("status").style.display = "none";
        } catch (error) {
          console.error("æ¤œç´¢ã‚¨ãƒ©ãƒ¼:", error);
          showStatus("âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ", "error");
        } finally {
          document.getElementById("ask-btn").disabled = false;
        }
      }

      // RAGã¨ã®æ¯”è¼ƒ
      async function compareWithRAG() {
        const input = document.getElementById("question-input");
        const question = input.value.trim();

        if (!question) {
          alert("è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
          return;
        }

        try {
          showStatus("âš–ï¸ ä¸¡ã‚·ã‚¹ãƒ†ãƒ ã§æ¤œç´¢ä¸­...", "loading");
          document.getElementById("compare-btn").disabled = true;

          // ä¸¦è¡Œã—ã¦ä¸¡æ–¹ã®ã‚·ã‚¹ãƒ†ãƒ ã§æ¤œç´¢
          const [semanticResult, normalResult] = await Promise.all([
            semanticRAG.semanticQuery(question),
            normalRAG.query(question),
          ]);

          // æ¯”è¼ƒçµæœã‚’è¡¨ç¤º
          displayComparison(semanticResult, normalResult);

          document.getElementById("status").style.display = "none";
        } catch (error) {
          console.error("æ¯”è¼ƒã‚¨ãƒ©ãƒ¼:", error);
          showStatus("âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ", "error");
        } finally {
          document.getElementById("compare-btn").disabled = false;
        }
      }

      // æ¯”è¼ƒçµæœã®è¡¨ç¤º
      function displayComparison(semanticResult, normalResult) {
        const container = document.getElementById("comparison");
        const content = document.getElementById("comparison-content");

        content.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #667eea;">ğŸ§  ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯RAG</h4>
                        <p><strong>å›ç­”:</strong> ${semanticResult.answer.substring(
                          0,
                          200
                        )}...</p>
                        <p><strong>ä½¿ç”¨æ¦‚å¿µ:</strong> ${semanticResult.conceptsUsed.join(
                          ", "
                        )}</p>
                        <p><strong>å‚è€ƒæ–‡æ›¸æ•°:</strong> ${
                          semanticResult.sources.length
                        }</p>
                    </div>

                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h4 style="color: #2196F3;">ğŸ“š é€šå¸¸RAG</h4>
                        <p><strong>å›ç­”:</strong> ${normalResult.response.substring(
                          0,
                          200
                        )}...</p>
                        <p><strong>å‚è€ƒæ–‡æ›¸æ•°:</strong> ${
                          normalResult.sources.length
                        }</p>
                    </div>
                </div>
            `;

        container.style.display = "block";
      }

      // Enterã‚­ãƒ¼ã§æ¤œç´¢
      document.addEventListener("keypress", (e) => {
        if (e.key === "Enter" && !document.getElementById("ask-btn").disabled) {
          askSemantic();
        }
      });
    </script>
  </body>
</html>